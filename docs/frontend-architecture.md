# 前端架构说明

## 一、目录结构功能概述

```
frontend/
├── index.html              # 应用入口 HTML 文件
├── package.json            # 项目配置和依赖管理
├── vite.config.ts          # Vite 构建工具配置
├── tsconfig.json           # TypeScript 配置
└── src/                    # 源代码目录
    ├── main.ts             # 应用启动入口
    ├── App.vue             # 根组件
    ├── api/                # API 接口层
    ├── assets/             # 静态资源
    ├── components/         # 可复用组件
    ├── router/             # 路由配置
    ├── stores/             # Pinia 状态管理
    ├── types/              # TypeScript 类型定义
    └── views/              # 页面视图组件
```

### 1.1 根目录文件

| 文件 | 功能 |
|------|------|
| `index.html` | 应用 HTML 模板，定义挂载点 `#app` |
| `package.json` | 项目依赖、脚本命令配置 |
| `vite.config.ts` | Vite 构建配置，包含代理、别名等 |
| `tsconfig.json` | TypeScript 编译配置 |

### 1.2 src/api/ - API 接口层

纯函数层，封装所有后端 API 调用，不管理状态。

| 文件 | 功能 |
|------|------|
| `client.ts` | Axios 实例配置，baseURL、拦截器 |
| `crops.ts` | 粮食/作物相关 API（CRUD、收获） |
| `animals.ts` | 动物相关 API（CRUD） |
| `flowers.ts` | 花卉相关 API（CRUD） |
| `statistics.ts` | 统计数据 API（概览、图表、日历） |

### 1.3 src/stores/ - Pinia 状态管理

封装 API 调用，管理数据状态和加载/错误状态。

| 文件 | 功能 |
|------|------|
| `crops.ts` | 粮食数据状态管理 |
| `animals.ts` | 动物数据状态管理 |
| `flowers.ts` | 花卉数据状态管理 |
| `statistics.ts` | 统计数据状态管理 |

### 1.4 src/types/ - 类型定义

TypeScript 接口定义，与后端 Pydantic schemas 对应。

| 文件 | 功能 |
|------|------|
| `crop.ts` | Crop、CropCreate、CropUpdate、CropStatus |
| `animal.ts` | Animal、AnimalCreate、AnimalUpdate、ProductType |
| `flower.ts` | Flower、FlowerCreate、FlowerUpdate、BloomSeason |
| `statistics.ts` | OverviewStats、ChartData、CalendarEvent |

### 1.5 src/views/ - 页面视图

路由对应的页面组件。

| 文件 | 功能 |
|------|------|
| `Dashboard.vue` | 仪表盘首页，展示系统概览 |
| `CropsView.vue` | 粮食/作物管理页面 |
| `AnimalsView.vue` | 动物管理页面 |
| `FlowersView.vue` | 花卉管理页面 |
| `StatisticsView.vue` | 统计分析页面，包含图表 |

### 1.6 src/components/ - 可复用组件

可复用的 UI 组件（目前为空，待开发）。

| 子目录 | 用途 |
|--------|------|
| `common/` | 通用组件 |
| `crops/` | 粮食相关组件 |
| `animals/` | 动物相关组件 |
| `flowers/` | 花卉相关组件 |
| `charts/` | 图表组件 |

### 1.7 src/router/ - 路由配置

| 文件 | 功能 |
|------|------|
| `index.ts` | 定义所有路由规则，配置懒加载 |

### 1.8 src/assets/ - 静态资源

| 目录/文件 | 功能 |
|-----------|------|
| `styles/main.css` | 全局样式文件 |

---

## 二、应用启动流程

当用户在浏览器打开 `index.html` 时，整个调用流转如下：

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          1. 浏览器加载 index.html                        │
│                    ┌─────────────────────────────────┐                  │
│                    │  <div id="app"></div>           │                  │
│                    │  <script src="/src/main.ts">    │                  │
│                    └─────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          2. 执行 main.ts                                 │
│    ┌────────────────────────────────────────────────────────────────┐   │
│    │  1. import { createApp } from 'vue'                            │   │
│    │  2. import { createPinia } from 'pinia'                        │   │
│    │  3. import App from './App.vue'                                │   │
│    │  4. import router from './router'                              │   │
│    │  5. import './assets/styles/main.css'                          │   │
│    │                                                                │   │
│    │  6. const app = createApp(App)        // 创建 Vue 应用实例     │   │
│    │  7. app.use(createPinia())             // 注册 Pinia           │   │
│    │  8. app.use(router)                    // 注册 Router          │   │
│    │  9. app.mount('#app')                  // 挂载到 #app          │   │
│    └────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    ▼                               ▼
        ┌──────────────────────┐      ┌──────────────────────┐
        │   加载 router/index.ts│      │   初始化 Pinia       │
        │   创建路由实例        │      │   创建 store 实例    │
        └──────────────────────┘      └──────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                          3. 渲染 App.vue                                │
│                    ┌─────────────────────────────────┐                  │
│                    │  <template>                      │                  │
│                    │    <div id="app">                │                  │
│                    │      <router-view />             │                  │
│                    │    </div>                        │                  │
│                    │  </template>                     │                  │
│                    └─────────────────────────────────┘                  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    4. Router 匹配当前 URL，渲染对应 View                  │
│                                                                         │
│   URL            │   匹配路由   │   渲染组件                             │
│   ───────────────┼─────────────┼────────────────────────────────────   │
│   /              │   Dashboard │   Dashboard.vue                        │
│   /crops         │   Crops     │   CropsView.vue                        │
│   /animals       │   Animals   │   AnimalsView.vue                      │
│   /flowers       │   Flowers   │   FlowersView.vue                      │
│   /statistics    │   Statistics│   StatisticsView.vue                   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    5. View 组件通过 Store 获取数据                        │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐  │
│   │  View.vue                                                        │  │
│   │    │                                                            │  │
│   │    ├── onMounted(() => {                                        │  │
│   │    │     useCropsStore().fetchCrops()  // 调用 Store            │  │
│   │    │   })                                                        │  │
│   │    │                                                            │  │
│   │    └── <template>                                               │  │
│   │        <div v-for="crop in crops">...</div>                     │  │
│   │                                                                │  │
│   └─────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    6. Store 调用 API 层获取数据                          │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐  │
│   │  stores/crops.ts                                                 │  │
│   │    │                                                            │  │
│   │    ├── import { getCrops } from '@/api/crops'                  │  │
│   │    │                                                            │  │
│   │    └── async fetchCrops() {                                     │  │
│   │          this.loading = true                                    │  │
│   │          try {                                                  │  │
│   │            this.crops = await getCrops()  // 调用 API           │  │
│   │          } catch (err) {                                        │  │
│   │            this.error = err.response?.data?.detail              │  │
│   │          } finally {                                            │  │
│   │            this.loading = false                                 │  │
│   │          }                                                      │  │
│   │        }                                                        │  │
│   └─────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    7. API 层通过 Axios 发送 HTTP 请求                    │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐  │
│   │  api/crops.ts                                                    │  │
│   │    │                                                            │  │
│   │    ├── import client from './client'                            │  │
│   │    │                                                            │  │
│   │    └── export async function getCrops() {                       │  │
│   │          const response = await client.get('/crops')            │  │
│   │          return response.data                                   │  │
│   │        }                                                        │  │
│   │                                                                │  │
│   │  api/client.ts                                                  │  │
│   │    ├── baseURL: VITE_API_URL                                   │  │
│   │    └── 开发环境代理: /api -> http://localhost:8000              │  │
│   └─────────────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    8. 后端 FastAPI 返回数据                              │
│                                                                         │
│                              Backend (FastAPI)                          │
│    ┌────────────────────────────────────────────────────────────────┐   │
│   http://localhost:8000/api/v1/crops                                 │   │
│    └────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                    9. 数据回流，View 自动更新渲染                         │
│                                                                         │
│   API Response → Store State → View Re-render                           │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 三、数据流架构

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              View Layer                                 │
│                         (Views/ Components)                             │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 调用 action / 读取 state
┌─────────────────────────────────────────────────────────────────────────┐
│                             Store Layer                                 │
│                          (Pinia Stores)                                 │
│                    管理 loading / error / data                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 调用 API 函数
┌─────────────────────────────────────────────────────────────────────────┐
│                              API Layer                                  │
│                    (api/*.ts - 纯函数，无状态)                           │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ HTTP 请求
┌─────────────────────────────────────────────────────────────────────────┐
│                           Axios Client                                  │
│                   (client.ts - baseURL/拦截器)                          │
└─────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼ 代理转发
┌─────────────────────────────────────────────────────────────────────────┐
│                           Backend API                                   │
│                         (FastAPI + PostgreSQL)                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 四、关键配置

### 4.1 环境变量

| 变量 | 说明 |
|------|------|
| `VITE_API_URL` | 后端 API 地址，默认 `http://localhost:8000/api/v1` |

### 4.2 Vite 代理配置

开发环境下，`/api` 请求会被代理到后端：

```typescript
server: {
  host: '0.0.0.0',
  port: 5173,
  proxy: {
    '/api': 'http://localhost:8000'
  }
}
```

### 4.3 路径别名

| 别名 | 指向 |
|------|------|
| `@` | `src/` |

---

## 五、技术栈

| 技术 | 用途 |
|------|------|
| Vue 3 | 渐进式前端框架 |
| TypeScript | 类型安全 |
| Pinia | 状态管理 |
| Vue Router | 路由管理 |
| Vite | 构建工具 |
| Axios | HTTP 客户端 |
| ECharts | 数据可视化 |
